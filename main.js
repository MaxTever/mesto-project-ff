(()=>{"use strict";const e={baseUrl:"https://mesto.nomoreparties.co/v1/cohort-magistr-2",headers:{authorization:"2c52cbd0-8443-48a6-b868-b477d1541e37","Content-Type":"application/json"}},t=e=>e.ok?e.json():Promise.reject(e.status),o=o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"PUT",headers:e.headers}).then(t),r=o=>fetch(`${e.baseUrl}/cards/likes/${o}`,{method:"DELETE",headers:e.headers}).then(t),n=o=>fetch(`${e.baseUrl}/cards/${o}`,{method:"DELETE",headers:e.headers}).then(t),c=document.querySelector("#card-template").content,a=document.querySelector(".places__list");function s(e,t,o,r,n){const a=c.querySelector(".card").cloneNode(!0),s=a.querySelector(".card__image"),u=a.querySelector(".card__delete-button"),i=a.querySelector(".card__like-button");let d=a.querySelector(".card__like-button-counter");return d.textContent=e.likes.length,a.querySelector(".card__title").textContent=e.name,s.alt=e.name,s.src=e.link,e.likes.some((e=>e._id===n))&&i.classList.add("card__like-button_is-active"),e.owner._id==n?u.addEventListener("click",(function(t){l(t,e._id)})):u.style.display="none",i.addEventListener("click",(t=>o(t,e.likes,d,e._id))),s.addEventListener("click",r),a}function l(e,t){n(t).then((()=>{!function(e){e.target.closest(".places__item").remove()}(e)})).catch((e=>{console.log(e)}))}function u(e,t,n,c){(e.target.classList.contains("card__like-button_is-active")?r:o)(c).then((t=>{n.textContent=t.likes.length,e.target.classList.toggle("card__like-button_is-active")})).catch((e=>console.log(e)))}function i(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",p)}function d(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",p)}function p(e){"Escape"===e.key&&d(document.querySelector(".popup_is-opened"))}const _=(e,t,o)=>{const r=e.querySelector(`.${t.id}-error`);t.classList.remove(o.inputErrorClass),r.classList.remove(o.errorClass),r.textContent=""},m=(e,t)=>{e.classList.add(t.inactiveButtonClass),e.disabled=!0},y=(e,t,o)=>{(e=>e.some((e=>!e.validity.valid)))(e)?m(t,o):(t.disabled=!1,t.classList.remove(o.inactiveButtonClass))};function h(e,t){const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);o.forEach((o=>{_(e,o,t)})),m(r,t)}document.querySelector(".content");const f=document.querySelector(".popup_type_new-card"),v=document.querySelector(".profile__add-button"),S=document.querySelector(".popup_type_image"),b=document.querySelector(".popup__image"),q=document.querySelector(".popup__caption"),g=document.querySelector(".popup__input_type_card-name"),E=document.querySelector(".popup__input_type_url"),C=document.forms.newplace,L=document.querySelectorAll(".popup"),k=newplace.elements.popup__button_add;let $="";const x=document.querySelector(".profile__edit-button"),A=document.querySelector(".popup_type_edit"),U=A.querySelector(".popup__form"),T=U.querySelector(".popup__input_type_name"),w=U.querySelector(".popup__input_type_description"),B=A.querySelector(".popup__button"),D=document.querySelector(".profile__title"),P=document.querySelector(".profile__description"),N=document.querySelector(".popup_type_add-avatar"),O=document.forms.formAvatarEdit,j=N.querySelector(".popup__input_type_url"),J=formAvatarEdit.elements.popup__button_add,M=document.querySelector(".profile__image-hover"),H=document.querySelector(".profile__image"),I={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};function V(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function z(e){i(S),b.src=e.target.src,b.alt=e.target.closest(".card").textContent,q.textContent=e.target.closest(".card").textContent}x.addEventListener("click",(function(e){i(A),T.value=D.textContent,w.value=P.textContent,h(U,I)})),U.addEventListener("submit",(function(o){var r,n;o.preventDefault(),V(!0,B),(r=T.value,n=w.value,fetch(`${e.baseUrl}/users/me`,{method:"PATCH",headers:e.headers,body:JSON.stringify({name:r,about:n})}).then(t)).then((e=>{d(A),D.textContent=e.name,P.textContent=e.about})).finally((()=>{V(!1,B)})).catch((e=>{console.log(e)}))})),C.addEventListener("submit",(function(o){var r,n;o.preventDefault(),V(!0,k),(r=g.value,n=E.value,fetch(`${e.baseUrl}/cards`,{method:"POST",headers:e.headers,body:JSON.stringify({name:r,link:n})}).then(t)).then((e=>{a.prepend(s(e,0,u,z,$))})).then((()=>{d(f),C.reset()})).then((()=>{h(C,I)})).finally((()=>{V(!1,k)})).catch((e=>{console.log(e)}))})),v.addEventListener("click",(function(e){i(f)})),M.addEventListener("click",(function(e){i(N)})),O.addEventListener("submit",(function(o){var r;o.preventDefault(),V(!0,J),(r=j.value,fetch(`${e.baseUrl}/users/me/avatar`,{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:`${r}`})}).then(t)).then((e=>{H.style.backgroundImage=`url(${e.avatar})`})).then((()=>{d(N),O.reset()})).then((()=>{h(N,I),тесты})).finally((()=>{V(!1,J)})).catch((e=>{console.log(e)}))})),function(e){e.forEach((e=>{e.querySelector(".popup__close").addEventListener("click",(function(){d(e)})),e.addEventListener("click",(function(t){t.target===e&&d(e)}))}))}(L),Promise.all([fetch(`${e.baseUrl}/users/me`,{headers:e.headers}).then(t),fetch(`${e.baseUrl}/cards`,{headers:e.headers}).then(t)]).then((([e,t])=>{D.textContent=e.name,$=e._id,P.textContent=e.about,H.style.backgroundImage=`url(${e.avatar})`,t.forEach((function(e){const t=s(e,0,u,z,$);a.append(t)}))})).catch((e=>{console.log(e)})),(e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(function(e){e.preventDefault()})),((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);y(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{((e,t,o)=>{t.validity.patternMissmatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?_(e,t,o):((e,t,o,r)=>{const n=e.querySelector(`.${t.id}-error`);t.classList.add(r.inputErrorClass),n.textContent=o,n.classList.add(r.errorClass)})(e,t,t.validationMessage,o)})(e,n,t),y(o,r,t)}))}))})(t,e)}))})(I)})();